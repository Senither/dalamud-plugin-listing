<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dalamud Plugin Listing</title>
    <script src="//unpkg.com/alpinejs" defer></script>
    <link href="/assets/styles.css?id=@file-hash" rel="stylesheet">

    <script>
        async function loadRepositories() {
            const response = await fetch('/', {
                headers: {
                    'Accept': 'application/json'
                }
            })

            return (await response.json())
                .sort((a, b) => a.Name.localeCompare(b.Name))
        }
    </script>
</head>

<body class="bg-gray-950 text-slate-50" x-data="{
    filteredRepositories() {
        this.updateUrlQuery()

        if (this.query.trim().length === 0) {
            return this.repositories
        }

        let query = this.query.toLowerCase().trim()

        return this.repositories.filter(repo => {
            return repo.Name.toLowerCase().includes(query) ||
                repo.Author.toLowerCase().includes(query) ||
                repo.Description?.toLowerCase().includes(query) ||
                repo.Punchline?.toLowerCase().includes(query)
        })
    },
    loadQueryFromUrl() {
        let url = new URL(window.location.href)
        let query = url.searchParams.get('q')

        if (query) {
            this.query = query
        }
    },
    updateUrlQuery() {
        let url = new URL(window.location.href)

        if (this.query.trim().length === 0) {
            url.searchParams.delete('q')
            window.history.pushState({}, '', url)
            return
        }

        url.searchParams.set('q', this.query)
        window.history.pushState({}, '', url)
    },
    repositories: [],
    query: '',
}" x-init="async () => {
    loadQueryFromUrl()

    repositories = await loadRepositories()
}">
    <div
        class="top-3 right-3 left-3 z-[-1] absolute bg-gradient-to-t from-gray-950 via-gray-500/5 to-indigo-500/20 rounded-t-3xl w-[95sw] h-[150vh]">
    </div>

    <div class="relative mx-auto px-4 pt-16 pb-12 max-w-5xl container">
        <div class="flex flex-col prose-invert max-w-full prose">
            <header class="mb-6">
                <h1>
                    Welcome to my <span class="text-[#fb8e81]">Dalamud</span> Plugin List
                </h1>

                <p>
                    I got tired of the clutter of having 15+ plugin repositories saved in Dalamud and not knowing what
                    plugins comes from which repository, some plugins also exists in multiple repositories which then
                    show up multiple times in the plugin list. So I made this small project to help some friends and
                    myself keep track of what plugins comes from where.
                </p>

                <p>
                    The list itself is a collection of <span class="font-bold text-indigo-100">@state-url-size</span>
                    different repositories, combined providing access to
                    <span class="font-bold text-indigo-100">@state-repo-size</span> plugins within a single repository,
                    including <span class="font-bold text-indigo-100">@state-internal-size</span> internal plugins with
                    <span class="font-bold text-indigo-100">@state-senither-size</span> of them being my own plugins.
                    The list is then updated once an hour to check for updates, this makes it possible to have a single
                    plugin repository in Dalamud and still get updates from all the different repositories.
                </p>

                <h2>FAQ</h2>

                <div class="flex flex-col gap-4">
                    <div class="bg-gray-600/20 shadow shadow-gray-900 px-4 py-1 border border-gray-900 rounded">
                        <details>
                            <summary>
                                <span class="cursor-pointer">
                                    Can I use this plugin list too?
                                </span>
                            </summary>

                            <p>Ofcourse! You can add this repository to Dalamud by following the steps below:</p>

                            <ul>
                                <li>Open Dalamud's settings (<code>/xlsettings</code>)</li>
                                <li>Click on the <code>Experimental</code> tab</li>
                                <li>Scroll Down to <code>Custom Plugin Repositories</code></li>
                                <li>
                                    Add the following URL: <code x-text="window.origin"></code>, then click on
                                    the Plus next to it
                                </li>
                                <li>Click on the Save icon in the bottom right corner</li>
                            </ul>

                            <div class="flex flex-col justify-center items-center w-full">
                                <p class="-mb-7">Example of how you add the repo to FFXIV.</p>
                                <img src="/assets/imgs/dalamud-add-plugin-repository.png"
                                    alt="Add custom plugin repository to Dalamud" class="rounded">
                            </div>
                        </details>
                    </div>

                    <div class="bg-gray-600/20 shadow shadow-gray-900 px-4 py-1 border border-gray-900 rounded">
                        <details>
                            <summary>
                                <span class="cursor-pointer">
                                    Where is Mare, Penumbra, Glamourer, ...etc?
                                </span>
                            </summary>
                            <p>
                                Mare Synchronos and some related plugins only works when they're installed from their
                                original repository list, if you'd like to use those plugins you should add the
                                official repository url.
                                <br>
                                <br>
                                <code>https://raw.githubusercontent.com/Ottermandias/SeaOfStars/main/repo.json</code>
                            </p>
                        </details>
                    </div>

                    <div class="bg-gray-600/20 shadow shadow-gray-900 px-4 py-1 border border-gray-900 rounded">
                        <details>
                            <summary>
                                <span class="cursor-pointer">
                                    Can I get only a small selection of the plugins?
                                </span>
                            </summary>
                            <p>
                                Yes! If you'd like to only get plugins which match specific criteria, such as containing
                                some text in the name, or getting plugins from a subset of authors, you can use the
                                following URLs:
                            </p>

                            <ul>
                                <li>
                                    /authors/&lt;search query&gt;.json
                                    <br><span class="text-sm">
                                        Finds all plugins matching the authors to your search query.
                                    </span>
                                </li>
                                <li>
                                    /plugins/&lt;search query&gt;.json
                                    <br><span class="text-sm">
                                        Finds all plugins matching the name, description, or punchline to your search
                                        query.
                                    </span>
                                </li>
                            </ul>
                            <p>
                                As an example, if you only want to get plugins I've made you could add the following
                                URL:
                                <br>
                                <code class="ml-4" x-text="window.origin + '/authors/senither.json'"></code>
                                <br>
                                or to get all plugins containing the word "auto" you could use the following URL:
                                <br>
                                <code class="ml-4" x-text="window.origin + '/plugins/auto.json'"></code>
                            </p>
                        </details>
                    </div>

                    <div class="bg-gray-600/20 shadow shadow-gray-900 px-4 py-1 border border-gray-900 rounded">
                        <details>
                            <summary>
                                <span class="cursor-pointer">
                                    What are the "internal" plugins?
                                </span>
                            </summary>
                            <p>
                                Internal plugins are plugins that are not loaded from any existing plugin list, but
                                instead linked directly with GitHub and the plugin releases from their repositories.
                            </p>

                            <p>
                                Internal plugins are updated automatically when a new release is created on GitHub, the
                                GitHub API is also used to fetch the download count for the <code>.zip</code> file in
                                the releases to show how many times an internal plugin has been downloaded.
                            </p>
                        </details>
                    </div>
                </div>
            </header>

            <section class="mb-8">
                <div class="flex justify-between items-end">
                    <h2>Available Plugins</h2>

                    <p class="flex justify-center items-center gap-1 opacity-75">
                        <span class="flex items-center" x-show="query.trim().length > 0">
                            <svg class="mr-2 w-5 h-5" data-slot="icon" fill="none" stroke-width="1.5"
                                stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
                                aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z">
                                </path>
                            </svg>
                            Found
                        </span>
                        <span x-text="filteredRepositories().length"></span>
                        <span x-text="filteredRepositories().length == 1 ? 'plugin' : 'plugins'"></span>
                    </p>
                </div>
                <!-- Add reset button for the query on the right side of the input -->
                <div class="flex justify-between items-center mx-4 rounded">
                    <input type="text" x-model="query"
                        class="peer bg-gray-950 focus:bg-slate-950 px-3 py-1 border border-gray-800 focus:border-indigo-700 rounded-l focus:outline-none w-full placeholder:text-slate-400 placeholder:italic"
                        placeholder="Search for plugins here...">
                    <button
                        class="flex items-center bg-indigo-900 disabled:bg-gray-950 px-3 py-1 border border-gray-800 focus:border-indigo-700 peer-focus:border-indigo-700 rounded-r"
                        x-bind:disabled="query.trim().length === 0" @click="query = ''">
                        <span x-bind:class="{ 'opacity-20': query.trim().length == 0 }">Reset</span>
                    </button>
                </div>
            </section>

            <section class="gap-8 grid grid-cols-1 md:grid-cols-2">
                <template x-for="repo in filteredRepositories()">
                    <div class="group relative flex flex-col justify-between">
                        <div
                            class="absolute -inset-2 bg-gradient-to-br from-indigo-600 to-violet-600 opacity-0 group-hover:opacity-15 blur-2xl rounded-lg transition-opacity duration-700">
                        </div>

                        <template x-if="repo.IsOutdated">
                            <div
                                class="absolute w-full h-full flex items-center justify-center group-hover:opacity-0 transition-none">
                                <span
                                    class="font-mono text-2xl font-extrabold bg-gray-950 text-white px-4 py-2 rounded">Outdated</span>
                            </div>
                        </template>

                        <div x-bind:class="{
                            'flex flex-col justify-between bg-gray-900 px-4 py-3 border border-gray-800 rounded h-full scale-95 group-hover:scale-100 transition-all duration-300': true,
                            'opacity-35 hover:opacity-80': repo.IsOutdated,
                        }">
                            <div>
                                <div class="flex justify-between">
                                    <div class="flex">
                                        <img class="shadow my-0 rounded-sm w-12 h-12" x-bind:src="repo.IconUrl" alt=""
                                            onerror="this.src = '/assets/not-found.svg'" loading="lazy">
                                        <div class="flex flex-col ml-4">
                                            <h4 class="mt-1 mb-0" x-text="repo.Name"></h4>
                                            <p class="my-0 -mt-2">v<span x-text="repo.AssemblyVersion"></span></p>
                                        </div>
                                    </div>

                                    <template x-if="repo.DownloadCount">
                                        <span class="flex items-center gap-2 opacity-75 text-sm">
                                            <span x-text="() => repo.DownloadCount.toLocaleString(undefined)"></span>

                                            <svg class="w-5 h-5" data-slot="icon" fill="none" stroke-width="1.5"
                                                stroke="currentColor" viewBox="0 0 24 24"
                                                xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                                <path stroke-linecap="round" stroke-linejoin="round"
                                                    d="M12 9.75v6.75m0 0-3-3m3 3 3-3m-8.25 6a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z">
                                                </path>
                                            </svg>
                                        </span>
                                    </template>
                                </div>

                                <div class="place-self-start">
                                    <div>
                                        <p>
                                            Created by <span x-text="repo.Author"></span>
                                        </p>
                                    </div>
                                    <p x-text="repo.Description.length > 0 ? repo.Description : repo.Punchline"></p>
                                </div>
                            </div>

                            <div class="flex justify-between items-end">
                                <a target="blank" x-bind:href="repo.RepoUrl"
                                    class="text-indigo-400 hover:text-indigo-300">Repository</a>

                                <template x-if="repo.OriginRepositoryUrl.IsInternalPlugin">
                                    <span
                                        class="bg-gray-800 opacity-40 hover:opacity-75 px-2 py-1 rounded text-sm transition-opacity">
                                        Internal plugin
                                    </span>
                                </template>
                                <template x-if="!repo.OriginRepositoryUrl.IsInternalPlugin">
                                    <a target="blank" x-bind:href="repo.OriginRepositoryUrl.RepositoryUrl"
                                        class="text-indigo-400 hover:text-indigo-300">Origin Repository List</a>
                                </template>
                            </div>
                        </div>
                    </div>

                </template>
            </section>

            <template x-if="query.trim().length > 0 && filteredRepositories().length === 0">
                <div
                    class="flex flex-col justify-center items-center py-16 border border-gray-900 border-dashed rounded text-gray-400 text-center">
                    <svg class="my-3 mr-4 w-12 h-12" data-slot="icon" fill="none" stroke-width="1.5"
                        stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z">
                        </path>
                    </svg>

                    <p>
                        No plugins found matching the search criteria.
                    </p>
                </div>
            </template>

            <footer class="flex justify-center items-center opacity-65 mt-8">
                <p>
                    Made for fun by
                    <a href="https://senither.com/" target="_blank" class="hover:text-indigo-400">Senither</a>
                    using
                    <a href="https://go.dev/" target="_blank" class="hover:text-indigo-400">Go</a>,
                    <a href="https://tailwindcss.com/" target="_blank" class="hover:text-indigo-400">TailwindCSS</a> and
                    <a href="https://alpinejs.dev/" target="_blank" class="hover:text-indigo-400">AlpineJS</a>.
                </p>
            </footer>
        </div>
    </div>
</body>

</html>
